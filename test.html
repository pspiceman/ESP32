<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ESP32 MQTT Dashboard</title>
<script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
<script src="https://cdn.tailwindcss.com"></script>

<style>
body {
  margin: 0;
  padding: 0;
  font-size: 20px;
}

/* ë¡œê·¸ì°½ */
#logBox {
  white-space: pre-line;
  height: 200px;
  background: #000;
  color: #0f0;
  padding: 12px;
  overflow-y: auto;
  border: 1px solid #333;
  font-family: Consolas, monospace;
  font-size: 1.0rem;

  /* ìœ„ ì¹´ë“œì™€ ë™ì¼í•œ í­ì„ ê°–ë„ë¡ */
  max-width: 420px;
  margin-left: auto;
  margin-right: auto;
}
#timeBox {
  text-align: right;
  color: #aaa;
  font-size: 1rem;
  margin-top: 6px;

  max-width: 420px;
  margin-left: auto;
  margin-right: auto;
}

/* ì •ë³´ ì¹´ë“œ */
.info-card {
  background: #1e293b;
  border: 1px solid #334155;
  border-radius: 14px;
  padding: 18px;
  display: flex;
  gap: 16px;
  align-items: center;

  /* â˜… íƒ€ì¼ í­ í™•ëŒ€í•˜ì—¬ ê¸€ì ì˜ë¦¼ í•´ê²° */
  width: 100%;
  max-width: 420px;

  margin-left: auto;
  margin-right: auto;
}

.info-title {
  font-size: 1.4rem;
  font-weight: 700;
}
.info-value {
  font-size: 2.1rem;
  font-weight: 900;
}

/* LED ìƒíƒœ í‘œì‹œ */
.led-on, .led-off {
  display: inline-block;
  padding: 10px 28px;
  border-radius: 14px;
  font-size: 1.8rem;
  font-weight: 900;
  color: #fff;
}
.led-on { background: #22c55e; }
.led-off { background: #ef4444; }

/* ë²„íŠ¼ */
.action-btn {
  padding: 16px 26px;
  border-radius: 14px;
  font-size: 1.8rem;
  font-weight: 900;
  text-align: center;
  width: 100%;
  max-width: 180px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.25);
  color: white;
}

/* ëª¨ë°”ì¼ ì „ìš© ìµœì í™” */
@media (max-width: 480px) {

  body { font-size: 26px; }

  /* 2Ã—2 íƒ€ì¼ì´ ìŠ¤ë§ˆíŠ¸í° í™”ë©´ì— ê½‰ ì°¨ë„ë¡ */
  .grid-cards {
    grid-template-columns: 1fr 1fr !important;
    gap: 10px !important;
  }

  .info-card {
    max-width: 100% !important;
  }

  .info-title { font-size: 1.6rem; }
  .info-value { font-size: 2.2rem; }

  #logBox {
    max-width: 100%;
  }
}
</style>
</head>

<body class="bg-slate-900 text-slate-100">

<div class="w-full mx-auto py-4 px-4">

  <!-- ì œëª© -->
  <h1 class="text-4xl font-extrabold mb-6 text-center">
    ESP32 MQTT Dashboard
  </h1>

  <!-- â˜… íƒ€ì¼ 2Ã—2 ë°”ë‘‘íŒ ë°°ì¹˜ -->
  <div class="grid grid-cols-2 gap-2 mb-6 place-items-center grid-cards">

    <!-- SSID -->
    <div class="info-card">
      <div class="text-4xl">ğŸ“¶</div>
      <div>
        <div class="info-title">SSID</div>
        <div id="ssid" class="info-value">--</div>
      </div>
    </div>

    <!-- RSSI -->
    <div class="info-card">
      <div class="text-4xl">ğŸ“¡</div>
      <div>
        <div class="info-title">RSSI</div>
        <div id="rssi" class="info-value">-- dBm</div>
      </div>
    </div>

    <!-- IP -->
    <div class="info-card">
      <div class="text-4xl">ğŸŒ</div>
      <div>
        <div class="info-title">IP</div>
        <div id="ip" class="info-value">--</div>
      </div>
    </div>

    <!-- LED ìƒíƒœ -->
    <div class="info-card">
      <div class="text-4xl">ğŸ’¡</div>
      <div>
        <div class="info-title">LED ìƒíƒœ</div>
        <div id="ledState" class="info-value">--</div>
      </div>
    </div>

  </div>

  <!-- ON / OFF / RESET -->
  <div class="flex justify-center gap-4 my-4">

    <button onclick="sendLED(1)"
      class="action-btn bg-green-600 active:scale-95 transition">
      ON
    </button>

    <button onclick="sendLED(0)"
      class="action-btn bg-yellow-500 active:scale-95 transition">
      OFF
    </button>

    <button onclick="sendReset()"
      class="action-btn bg-red-600 active:scale-95 transition">
      RESET
    </button>

  </div>

  <!-- ë¡œê·¸ -->
  <div id="logBox">[LOG] Readyâ€¦</div>
  <div id="timeBox">--:--:--</div>

</div>

<script>
let brokerURL = "wss://broker.hivemq.com:8884/mqtt";
let clientId = "espui_" + Math.random().toString(16).substr(2, 8);
let client = mqtt.connect(brokerURL, { clientId });

function log(msg) {
  const box = document.getElementById("logBox");
  box.textContent += "\n" + msg;
  box.scrollTop = box.scrollHeight;
}

client.on("connect", () => {
  log("[MQTT] Connected");
  client.subscribe("/esp32/status");
  client.subscribe("/esp32/log");
});

client.on("message", (topic, payload) => {
  const msg = payload.toString();

  if (topic === "/esp32/status") {
    let j = JSON.parse(msg);

    ssid.innerText = j.ssid;
    rssi.innerText = j.rssi + " dBm";
    ip.innerText = j.ip;

    if (j.led == 1)
      ledState.innerHTML = "<span class='led-on'>ON</span>";
    else
      ledState.innerHTML = "<span class='led-off'>OFF</span>";

    log("[STATUS] " + msg);
  }

  if (topic === "/esp32/log") log("[ESP] " + msg);
});

function sendLED(v) {
  client.publish("/esp32/cmd/led", String(v));
  log("[CMD] LED=" + v);
}

function sendReset() {
  client.publish("/esp32/cmd/reset", "1");
  log("[CMD] RESET");
}

setInterval(() => {
  const t = new Date();
  timeBox.innerText = t.toLocaleString("ko-KR", { hour12: false });
}, 1000);
</script>

</body>
</html>

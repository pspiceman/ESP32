<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<title>ESP32 MQTT IP + Reset</title>
<script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
<style>
  body { font-family: Arial; margin: 40px; }
  button { padding: 12px 20px; font-size: 18px; margin-top: 10px; }
  #log { margin-top: 20px; font-family: monospace; white-space: pre-wrap; }
  #ip { font-weight: bold; color: green; }
</style>
</head>
<body>

<h2>ESP32 MQTT IP + Soft Reset</h2>
<div>ESP32 IP: <span id="ip">-</span></div>
<button id="btnReset" disabled>ðŸ”„ ESP32 Reset</button>

<div id="log"></div>

<script>
const log = msg => {
  document.getElementById("log").textContent += msg + "\n";
};

// HiveMQ Cloud WebSocket ì—°ê²°
const options = {
  username: "mqtt_ESP32",
  password: "gomqtt_ESP32",
  reconnectPeriod: 2000,
  clean: true,
  connectTimeout: 4000
};

const client = mqtt.connect(
  "wss://6c56aefe0ddb4d57977c735f5070abe8.s1.eu.hivemq.cloud:8884/mqtt",
  options
);

client.on("connect", () => {
  log("MQTT ì—°ê²° ì™„ë£Œ!");
  client.subscribe("esp32/ip");        // ESP32 IP ìˆ˜ì‹ 
  client.subscribe("esp32/response");  // ë¦¬ì…‹/ìƒíƒœ ì‘ë‹µ ìˆ˜ì‹ 
  document.getElementById("btnReset").disabled = false;
});

client.on("error", err => log("MQTT ì˜¤ë¥˜: " + err));
client.on("close", () => log("MQTT ì—°ê²° ì¢…ë£Œ"));

client.on("message", (topic, message) => {
  const msg = message.toString();
  if(topic === "esp32/ip") {
    document.getElementById("ip").textContent = msg;
    log("[ESP32 IP] " + msg);
  } else if(topic === "esp32/response") {
    log("[ì‘ë‹µ] " + msg);
  }
});

// Reset ë²„íŠ¼ í´ë¦­ ì‹œ
document.getElementById("btnReset").addEventListener("click", () => {
  log("Reset ëª…ë ¹ ì „ì†¡...");
  client.publish("esp32/reset", "1");
});
</script>

</body>
</html>
